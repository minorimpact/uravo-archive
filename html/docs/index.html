<html>
    <head>
        <title>Uravo</title>
        <link rel="stylesheet" type="text/css" href="docs.css">
    </head>
    <body>
        <div id=content>
            <h1>Uravo</h1>
            <ol>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#installation">Installation</a></li>
                <li><a href="#configuration">Configuration</a></li>
                <li><a href="#updating">Updating</a></li>
            </ol>

            <a name=overview>
            <h2>Overview</h2>

            <a name=components>
            <h3>Components</h3>
            <p>
                Despite the various moving parts, Uravo is designed to be simple to install and configure, consisting of one RPM, one config
                file, and a handful of crontab entries. In addition to mysql, to store the all the data, and apache, to provide an interface,
                Uravo has the following major components:
            </p>
            <h4>outpost.pl</h4>
            <p>
                A single process that serves as a bridge between the agents and the database.  Only the outpost process talks to the database;
                all the other processes talk to the outpost.  The outpost process also serves as a simple caching server, so any scripts
                using the Uravo API can access some or all of their data without having to issue a database query.  This process can be run on any
                server that can connect to the database.
            </p>
            <h4>control.pl</h4>
            <p>
                A single process that performs pre- and post- processing actions on the alerts generated by the various agents.  This can run on any
                but is usually run on a server that's also running outpost.pl.
            </p>
            <h4>agent.pl</h4>
            <p>
                The main data collection script, this gets run on all servers with Uravo installed, and generates local alerts.
            </p>
            <h4>remote_agent.pl</h4>
            <p>
                Collects all 'remote,' or 'external' data, including ICMP and SNMP data.  This is usually run on one or two dedicated
                data collection servers, but can be executed from any number of machines, as it automatically load balances among
                the various instances in the same silo.
            </p>

            <a name=concepts>
            <h3>Concepts</h3>
            <p>
                Uravo is a tool for both generating alerts and maintaining and organizing your devices.  To that end, there a number of organizational
                concepts that should be understood.
            </p>
            <h4>Servers</h4>
            <p>
                The heart of Uravo is the 'server', which can be any kind of device.  For the most part, these will be actual servers, but it can also
                be a switch, a power supply, a chassis, a network vserver, or even a website.  A good rule of thumb is <em>if it's got an IP, it's a server.</em>
            </p>
            <h4>Clusters</h4>
            <p>
                A cluster is just a collection of servers.  A cluster could be all the servers that serve a particular website, or all the servers that belong
                to a particular group.  How you define a cluster is up to you, but a server can only exist in a single cluster.
            </p>
            <h4>Types</h4>
            <p>
                If a cluster tells you where a server is, then type tells you <em>what</em> a server is.  A type definition includes information about how
                to monitor a server, including which processes should be running, what local and remote checks it should respond to, and what the thresholds are
                for those checks.  Multiple types can be assigned to each server.
            </p>
            <h4>Silos</h4>
            <p>
                Essentially, a silo is a collection of clusters, but Uravo assumes that servers in different silos cannot talk to one another.  Therefore, each silo
                should have at least one Outpost server and at least one server running remote_agent.pl.
            </p>
            <h4>Business Units</h4>
            <p>
                Strictly an organizational tool, a Business Unit (or BU) is simply a collection of silos.
            </p>
            <h4>Netblocks</h4>
            <p>
            </p>
            <h4>Cage/Rack</h4>
            <p>
                Each server can should be assigned to a rack, which in turn is assigned to a cage.  This represents the physical location of the server. This is mostly
                for reporting purposes.
            </p>

            <a name=installation>
            <h2>Installation</h2>

            <h3>All servers</h3>
            <p>
                Installing the Uravo RPM is the same on all servers.  For the time being, it's assumed Uravo will be running as the 'root' user.  It's possible to change
                this, but several key functions won't work properly.  Future updates will address this.
                <div class=code>
                    [~]# yum install http://uravo.org/uravo-latest.noarch.rpm
                    [~]# cd /usr/local/uravo/config
                    [/usr/local/uravo/config]# cp uravo.conf /etc
                </div>
                Edit /etc/uravo.conf to suit your environment; consult the <a href="#configuration">configuration</a> section of this document for more information.
            </p>
            <p>
                Once all services are up and running, or if you're installing into an existing environment, run the update
                to automatically add the server to the system.
                <div class=code>
                    [~]# /usr/local/uravo/bin/update_uravo.pl
                </div>
            </p>

            <h3>Database</h3>
            <p>
                The MySQL server that will store the Uravo data.  After installing the Uravo RPM, install and configure MySQL, then execute the statements
                in the db-schema.sql and db-data.sql files.
                <div class=code>
                    [~]# yum install mysql-server
                    [~]# service mysql start
                    [~]# cd /usr/local/uravo/config
                    [/usr/local/uravo/config]# cat db-schema.sql | mysql
                    [/usr/local/uravo/config]# cat db-data.sql | mysql
                </div>
                The script will create a 'uravo' user with the password 'uravo'.  If you want to change this, be sure you also update the <a href="#configuration">configuration</a>.
            </p>

            <h3>Outpost</h3>
            <p>
                The outpost.pl script provides all database connectivity to the various uravo scripts, as well as a rudimentary caching service. Each server with Uravo installed
                needs to be able to connect to an Outpost server, and each outpost server needs to be able to connect directly to the Uravo database.  Aside from those requirements,
                any server with Uravo installed can be an outpost server.  Set up a cron to launch the outpost.pl process.
                <div class=code>
                    [~]# cat &lt;&lt;EOF &gt;&gt; /etc/cron.d/uravo-server
                    * * * * * root /usr/local/uravo/bin/outpost.pl &gt; /dev/null 2&gt;&#38;1 &#38;
                    EOF
                    [~]# chmod 644 /etc/cron.d/uravo-server
                </div>
                outpost.pl is designed to exit cleanly if a process is already running, so this ensures the process runs almost continuously.  You can run any number of outpost servers,
                but each server can only be configured to talk to one of them.
            </p>

            <h3>Control</h3>
            <p>
                control.pl does pre- and post-processing on new alerts, general cleanup, and maintains the alert history.  This is usually run on the same server with outpost.pl. 
                <div class=code>
                    [~]# cat &lt;&lt;EOF &gt;&gt; /etc/cron.d/uravo-server
                    * * * * * root /usr/local/uravo/bin/control.pl &gt; /dev/null 2&gt;&#38;1 &#38;
                    EOF
                    [~]# chmod 644 /etc/cron.d/uravo-server
                </div>
                Like outpost.pl, control.pl is designed to exit cleanly if a process is already running, so this ensures the process runs almost continuously.  You
                should only have a single control server in your Uravo environment.
            </p>

            <h3>remote_agent.pl</h3>
            <p>
                <div class=code>
                    [~]# cat &lt;&lt;EOF &gt;&gt; /etc/cron.d/uravo-server
                    * * * * * root /usr/local/uravo/bin/remote_agent.pl > /tmp/remote_agent.pl.log  2>&1
                    EOF
                    [~]# chmod 644 /etc/cron.d/uravo-server
                </div>
            </p>

            <h3 >Webserver</h3>
            <p>
                <div class=code>
                    [~]# yum install httpd
                    [~]# cat /usr/local/uravo/config/uravo_httpd.conf &gt;&gt; /etc/httpd/conf/httpd.conf
                    [~]# service httpd start
                </div>
            </p>

            <a name=updating>
            <h2>Updating</h2>
            <p>
                Make a note of the Uravo version before the update:
                <div class=code>
                    [~]# cat /usr/local/uravo/config/version.txt
                    0.0.4
                </div>
                Update the RPM to the latest version, and make a note of the new version:
                <div class=code>
                    [~]# yum update http://uravo.org/uravo-latest.noarch.rpm
                    [~]# cat /usr/local/uravo/config/version.txt
                    0.0.7
                </div>
                The config directory contains database update files with the changes that need to
                be applied for each RPM upgrade:
                <div class=code>
                    [~]# ls -la /usr/local/uravo/config/db-update*
                    /usr/local/uravo/config/db-update-0.0.3.sql
                    /usr/local/uravo/config/db-update-0.0.4.sql
                    /usr/local/uravo/config/db-update-0.0.5.sql
                    /usr/local/uravo/config/db-update-0.0.6.sql
                </div>
                As you can see, some versions did not include database updates. For this example, since we've gone from version 0.0.4 to version 0.0.7, only the updates for versions 0.0.5 and 0.0.6 need to be applied (presumably, the 0.0.4 changes were applied previously, and there were no database updates required specifically for version 0.0.7).  Apply the changes by piping the contents of the files to mysql:
                <div class=code>
                    [~]# cat /usr/local/uravo/config/db-update-0.0.5.sql | mysql
                    [~]# cat /usr/local/uravo/config/db-update-0.0.7.sql | mysql
                </div>
                Kill the control and outpost processes on the appropriate servers:
                <div class=code>
                    [~]# killall outpost.pl
                    [~]# killall contgrol.pl
                </div>
                The cron should restart these services automatically within a minute.
            </p>

            <a name=configuration>
            <h2>Configuration</h2>
            <p>
                There's only one configuration file for uravo: /etc/uravo.conf.  Below are a few of the key settings.
            </p>
            <p>
                <em>uravo_log</em> The location of the uravo logfile.<br />
                <em>outpost_server</em> The outpost server this installation should communicate with.<br />
                <em>outpost_db_port</em> On what port to connect to the outpost for database queries.<br />
                <em>db_user</em> A mysql user that has access to the "uravo" database.<br />
                <em>db_passwd</em> The correspond password for the "uravo" user.<br />
                <em>db-server</em> The actual server hosting the uravo database.<br />
                <em>db_port</em> The port number of the uravo database.<br />
            </p>

                
        </div>
    </body>
</html>
